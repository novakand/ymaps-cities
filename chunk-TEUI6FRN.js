import{j as D,q as N}from"./chunk-22QDKRRG.js";import{Da as _,Fa as C,G as B,I as M,Q as u,R as $,S as A,U as O,Z as a,a as w,b,ca as S,da as m,f as v,i as I,j as c,r as d,s as f,v as E,va as j}from"./chunk-I5INVV6P.js";var Q=(()=>{class t{constructor(){this.load$=new c(null),this.remove$=new c(null),this.cityBoundaries$=new c(!1),this.focusCity$=new c(null),this.clusterData$=new c(null),this.cityColorFilter$=new c(null)}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var L=(()=>{class t{constructor(){this.STORAGE_KEY="cities-settings",this.settings$=new c({}),this.loadFromStorage()}loadFromStorage(){let i=localStorage.getItem(this.STORAGE_KEY);if(i)try{let e=JSON.parse(i);e.settings?this.settings$.next(e.settings):this.settings$.next(e)}catch(e){console.error("CitiesSettings parse error",e),this.settings$.next({})}}hasSettings(){return!!localStorage.getItem(this.STORAGE_KEY)}save(i){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(i)),this.settings$.next(i)}getSettings(){return this.settings$.asObservable()}getRaw(){let i=localStorage.getItem(this.STORAGE_KEY);if(!i)return null;let e=JSON.parse(i);return{raw:e.raw,size:e.size,fileName:e.fileName||"cities-settings.csv"}}setFromCsv(i,e,s){let r={};i.forEach(n=>{n.name&&(r[n.name]=n.color||"")});let o={settings:r,raw:e,size:new Blob([e]).size,fileName:s,uploadedAt:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o)),this.settings$.next(r)}clear(){localStorage.removeItem(this.STORAGE_KEY),this.settings$.next({})}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var V=(()=>{class t{constructor(i,e){this.http=i,this.settingsService=e,this.BASE="assets/data",this.INDEX_URL=`${this.BASE}/cities.features.json`,this.POLYGONS_DIR=`${this.BASE}/polygons`,this.features$=this.http.get(this.INDEX_URL).pipe(u({bufferSize:1,refCount:!0})),this.cities$=this.features$.pipe(d(s=>s.map(r=>b(w({},r.properties),{slug:r.properties?.label,center:r.geometry?.coordinates,bbox:r.properties?.bbox,enabled:r.properties?.enabled}))),u({bufferSize:1,refCount:!0})),this.mergedCities$=f([this.cities$,this.settingsService.getSettings()]).pipe(d(([s,r])=>Object.keys(r).length?s.map(o=>{let n=Object.prototype.hasOwnProperty.call(r,o.name),h=r[o.name];return b(w({},o),{enabled:n,color:n&&h?h:o.color})}).filter(o=>o.enabled):s.filter(o=>o.enabled!==!1)),u({bufferSize:1,refCount:!0})),this.polyCache=new Map}findEnabled(){return this.mergedCities$}findAll(){return this.cities$}getById(i){return this.cities$.pipe(d(e=>e.find(s=>s.id===i)))}getBySlug(i){return this.cities$.pipe(d(e=>e.find(s=>s.slug===i)))}search(i){let e=(i||"").toLowerCase().trim();return e?this.cities$.pipe(d(s=>s.filter(r=>(r.name||"").toLowerCase().includes(e)||(r.region?.name||"").toLowerCase().includes(e)))):this.cities$}getFeatures(){return this.features$}getPolygon(i){let e=String(i);if(this.polyCache.has(e))return this.polyCache.get(e);let s=`${this.POLYGONS_DIR}/${e}.json`,r=this.http.get(s).pipe(u({bufferSize:1,refCount:!0}));return this.polyCache.set(e,r),r}static{this.\u0275fac=function(e){return new(e||t)(S(N),S(L))}}static{this.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var x;try{x=typeof Intl<"u"&&Intl.v8BreakIterator}catch{x=!1}var R=(()=>{class t{_platformId=m(_);isBrowser=this._platformId?D(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||x)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function y(t){return Array.isArray(t)?t:[t]}var T=new Set,l,F=(()=>{class t{_platform=m(R);_nonce=m(C,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):z}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&G(i,this._nonce),this._matchMedia(i)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function G(t,p){if(!T.has(t))try{l||(l=document.createElement("style"),p&&l.setAttribute("nonce",p),l.setAttribute("type","text/css"),document.head.appendChild(l)),l.sheet&&(l.sheet.insertRule(`@media ${t} {body{ }}`,0),T.add(t))}catch(i){console.error(i)}}function z(t){return{matches:t==="all"||t==="",media:t,addListener:()=>{},removeListener:()=>{}}}var W=(()=>{class t{_mediaMatcher=m(F);_zone=m(j);_queries=new Map;_destroySubject=new I;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return k(y(i)).some(s=>this._registerQuery(s).mql.matches)}observe(i){let s=k(y(i)).map(o=>this._registerQuery(o).observable),r=f(s);return r=E(r.pipe(M(1)),r.pipe($(1),B(0))),r.pipe(d(o=>{let n={matches:!1,breakpoints:{}};return o.forEach(({matches:h,query:P})=>{n.matches=n.matches||h,n.breakpoints[P]=h}),n}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);let e=this._mediaMatcher.matchMedia(i),r={observable:new v(o=>{let n=h=>this._zone.run(()=>o.next(h));return e.addListener(n),()=>{e.removeListener(n)}}).pipe(A(e),d(({matches:o})=>({query:i,matches:o})),O(this._destroySubject)),mql:e};return this._queries.set(i,r),r}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function k(t){return t.map(p=>p.split(",")).reduce((p,i)=>p.concat(i)).map(p=>p.trim())}export{Q as a,L as b,V as c,R as d,y as e,W as f};
