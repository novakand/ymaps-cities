<div class="c-map">
  <map-sidebar
    [isVisible]="isVisible"
    (visibleChange)="onVisibleChangeSidebar($event)"
  ></map-sidebar>


  <div class="c-map-toolbar-horizontal">
    <map-search-control
      (locationSelected)="onLocationSelected($event)"
      (locationCleared)="onLocationCleared()"
    >
    </map-search-control>
    <!-- <map-legend-control></map-legend-control> -->
    <div class="flex-fill"></div>


    <div class="flex-fill"></div>
  </div>

  <div class="c-map-toolbar-vertical">
    <map-settings-control
      (onChange)="onChangeSettings($event)"
      [isShowSettingsControl]="true"
    >
    </map-settings-control>
    <div class="flex-fill"></div>
    <map-fullscreen-control
      *ngIf="isLargeScreen"
      [fullscreenClass]="fullscreenClass"
    ></map-fullscreen-control>
    <div class="c-map__y-offset"></div>
    <map-zoom-control *ngIf="isLargeScreen"></map-zoom-control>

    <div class="flex-fill"></div>

  </div>
  <div class="c-map-toolbar-horizontal c-map-toolbar-horizontal__bottom">
    <div class="flex-fill"></div>

  </div>
  <ng-container *ngIf="!isMapLoad">
    <p-skeleton
      width="100%"
      height="100%"
    />
  </ng-container>
  <y-map
    [props]="{
    location: {
      center: [37.617698, 55.755864],
      zoom: 4
    },
    theme: theme(),
    zoomRange: zoomRange(),
    margin: [0,0,0,0]
  }"
    (ready)="onMapReady($event)"
  >

    <y-map-default-scheme-layer />
    <y-map-default-features-layer />
    <y-map-mouse></y-map-mouse>



    <ng-container>



      <y-map-feature-data-source [props]="{ id: 'cities' }" />

      <y-map-layer [props]="{
      source: 'cities',
      type: 'features',
      zIndex: 1400
    }" />

    </ng-container>


    <ng-container *ngFor="let f of citiesFeatures; trackBy: trackById">
      <y-map-feature [props]="{
      source: 'cities',
      hideOutsideViewport: true,
      id: f.id,  
      geometry: f.geometry,
      properties: f.properties,
      style: f.style
    }" />

    </ng-container>

    <ng-container *ngIf="searchMarker as m">
      <y-map-marker [props]="{
      coordinates: m.coordinates,
      zIndex: 3000,
    }">

        <div
          class="ym-marker"
          style="position: relative; z-index: 3000;"
        >


          <div
            class="ym-marker__circle"
            [style.--marker-color]="m.color || '#E63D2E'"
          >
            <svg viewBox="0 0 24 24">

              <circle
                cx="12"
                cy="12"
                r="12"
                fill="var(--marker-color)"
              />

              <circle
                cx="12"
                cy="12"
                r="9"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
              />
            </svg>
          </div>


          <div class="ym-marker__icon">
            <svg viewBox="0 0 24 24">

            </svg>
          </div>


          <div
            *ngIf="true"
            class="ym-marker__label"
          >
            {{ m.title }}
          </div>

        </div>

      </y-map-marker>
    </ng-container>


    <ng-container *ngFor="let m of cityMarkers">
      <y-map-marker [props]="{
      coordinates: m.coordinates,
      hideOutsideViewport: true,
      zIndex: 3000,
      properties: {
        hint: {
          title: m.title,
          color: m.color
        }
      }
    }">

        <div
          class="ym-marker"
          [appCollisionLabel]="m.id"
          style="position: relative; z-index: 3000;"
        >


          <div
            class="ym-marker__circle"
            [style.--marker-color]="m.color || '#E63D2E'"
          >
            <svg viewBox="0 0 24 24">

              <circle
                cx="12"
                cy="12"
                r="9"
                fill="var(--marker-color)"
              />

              <circle
                cx="12"
                cy="12"
                r="9"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
              />
            </svg>
          </div>


          <div class="ym-marker__icon">
            <svg viewBox="0 0 24 24">

            </svg>
          </div>


          <div
            *ngIf="false"
            class="ym-marker__label"
            [appCollisionLabel]="m.id"
          >
            {{ m.title }}
          </div>

        </div>

      </y-map-marker>
    </ng-container>


    <y-map-hint [props]="{ hint: onHint }">
      <ng-template let-context>
        <div class="ym-hint">
          <div class="ym-hint__header">
            <span
              class="ym-hint__dot"
              [style.background]="context?.hint?.color"
            ></span>
            {{ context?.hint?.title }}
          </div>

          <div
            class="ym-hint__coords"
            *ngIf="context?.hint?.coords"
          >
            {{ context?.hint?.coords[1] }},
            {{ context?.hint?.coords[0] }}
          </div>
        </div>
      </ng-template>
    </y-map-hint>


  </y-map>

</div>