<div class="c-map">
  <map-sidebar
    [isVisible]="isVisible"
    (visibleChange)="onVisibleChangeSidebar($event)"
  ></map-sidebar>


  <div class="c-map-toolbar-horizontal">
    <map-search-control></map-search-control>
    <!-- <map-legend-control></map-legend-control> -->
    <div class="flex-fill"></div>


    <div class="flex-fill"></div>
  </div>

  <div class="c-map-toolbar-vertical">
    <map-settings-control
      (onChange)="onChangeSettings($event)"
      [isShowSettingsControl]="true"
    >
    </map-settings-control>
    <div class="flex-fill"></div>
    <map-fullscreen-control [fullscreenClass]="fullscreenClass"></map-fullscreen-control>
    <div class="c-map__y-offset"></div>
    <map-zoom-control></map-zoom-control>

    <div class="flex-fill"></div>

  </div>
  <div class="c-map-toolbar-horizontal c-map-toolbar-horizontal__bottom">
    <div class="flex-fill"></div>

  </div>
  <ng-container *ngIf="!isMapLoad">
    <p-skeleton
      width="100%"
      height="100%"
    />
  </ng-container>
  <y-map
    [props]="{
          location: {
            center: center(),
            zoom: zoom(),
          
            
          },
          theme: theme(),
          zoomRange:zoomRange(),
          margin: [5, 5, 5, 5]
        }"
    (ready)="onMapReady($event)"
  >
    <y-map-mouse></y-map-mouse>
    <y-map-default-scheme-layer />
    <y-map-default-features-layer />

    <y-map-feature-data-source [props]="{ id: 'cities' }" />
    <y-map-layer [props]="{ source: 'cities', type: 'features', zIndex: 1000 }" />
    <y-map-feature-data-source [props]="{ id: 'markers' }" />

    <y-map-layer [props]="{ source: 'markers', type: 'features', zIndex: 3000 }" />





    <!-- <ng-container *ngFor="let m of cityMarkers; trackBy: trackByMarkerId">
      <y-map-feature [props]="{
    source: 'markers',        
    hideOutsideViewport: { extent: 200 },
    id: m.id,
    geometry: {
      type: 'Point',
      coordinates: m.coordinates
    },
    properties: {
      hint: {
        title: m.title,
        color: m.color
      }
    },
    style: {
      cursor: 'pointer',
      icon: {
        url: 'data:image/svg+xml;utf8,' + encodeURIComponent(
          '<svg xmlns=&quot;http://www.w3.org; width=&quot;24&quot; height=&quot;24&quot;>' +
          '<circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;6&quot; fill=&quot;' + (m.color || '#E63D2E') + '&quot; stroke=&quot;#ffffff&quot; stroke-width=&quot;2&quot;/>' +
          '</svg>'
        ),
        
        offset: [-12, -12]
      }
    }
  }" />
    </ng-container> -->
    <!-- <y-map-feature-data-source [props]="{ id: 'markers' }" />
    <y-map-layer [props]="{ source: 'markers', type: 'features', zIndex: 1900 }" />


    <ng-container *ngIf="markerFeatures">
      <ng-container *ngFor="let f of markerFeatures; trackBy: trackByMarkerId">
        <y-map-feature [props]="f"></y-map-feature>
      </ng-container>
    </ng-container> -->




    <!-- Рендерим фичи, привязанные к источнику 'cities' -->
    <ng-container *ngFor="let f of citiesFeatures; trackBy: trackById">
      <y-map-feature [props]="{
      source: 'cities',
       hideOutsideViewport: { extent: 200 },
      id: f.id,  
      geometry: f.geometry,
      properties: f.properties,
      style: f.style
    }" />

    </ng-container>


    <!-- <ng-container *ngFor="let m of cityMarkers">
      <y-map-marker [props]="{ coordinates: m.coordinates,hideOutsideViewport: true,zIndex: 9000 }">

        <div
          class="ym-marker"
          style="position: relative; z-index: 3000;"
          [appCollisionLabel]="m.id"
        >

          
          <div
            class="ym-marker__circle"
            [style.--marker-color]="m.color || '#E63D2E'"
          >
            <svg viewBox="0 0 24 24">
             
              <circle
                cx="12"
                cy="12"
                r="9"
                fill="var(--marker-color)"
              />
              
              <circle
                cx="12"
                cy="12"
                r="9"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
              />
            </svg>
          </div>


          <div class="ym-marker__icon">
            <svg viewBox="0 0 24 24">
           
            </svg>
          </div>

         
          <div class="ym-marker__label">
            {{ m.title }}
          </div>

        </div>

      </y-map-marker>
    </ng-container> -->


    <y-map-hint [props]="{ hint: onHint }">
      <ng-template let-context>
        <div class="ym-hint">
          <div class="ym-hint__header">
            <span
              class="ym-hint__dot"
              [style.background]="context?.hint?.color"
            ></span>
            {{ context?.hint?.title }}
          </div>

          <div
            class="ym-hint__coords"
            *ngIf="context?.hint?.coords"
          >
            {{ context?.hint?.coords[1] }},
            {{ context?.hint?.coords[0] }}
          </div>
        </div>
      </ng-template>
    </y-map-hint>

    <!-- <ng-container *ngFor="let m of cityMarkers">
      <y-map-default-marker [props]="{
      coordinates: m.coordinates,
      title: m.title,
      color: '#E63D2E'
    }" />
    </ng-container> -->


  </y-map>

</div>