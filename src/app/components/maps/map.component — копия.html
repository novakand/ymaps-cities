<div class="c-map">
  <map-sidebar
    [isVisible]="isVisible"
    (visibleChange)="onVisibleChangeSidebar($event)"
  ></map-sidebar>


  <div class="c-map-toolbar-horizontal">
    <map-search-control></map-search-control>
    <!-- <map-legend-control></map-legend-control> -->
    <div class="flex-fill"></div>


    <div class="flex-fill"></div>
  </div>

  <div class="c-map-toolbar-vertical">
    <map-settings-control
      (onChange)="onChangeSettings($event)"
      [isShowSettingsControl]="true"
    >
    </map-settings-control>
    <div class="flex-fill"></div>
    <map-fullscreen-control [fullscreenClass]="fullscreenClass"></map-fullscreen-control>
    <div class="c-map__y-offset"></div>
    <map-zoom-control></map-zoom-control>

    <div class="flex-fill"></div>

  </div>
  <div class="c-map-toolbar-horizontal c-map-toolbar-horizontal__bottom">
    <div class="flex-fill"></div>

  </div>
  <ng-container *ngIf="!isMapLoad">
    <p-skeleton
      width="100%"
      height="100%"
    />
  </ng-container>
  <y-map
    [props]="{
          location: {
            center: center(),
            zoom: zoom(),
             bounds: bounds(),
            
          },
          theme: theme(),
          zoomRange:zoomRange(),
          margin: [5, 5, 5, 5]
        }"
    (ready)="onMapReady($event)"
  >
    <y-map-mouse></y-map-mouse>
    <y-map-default-scheme-layer />
    <y-map-default-features-layer />

    <y-map-feature-data-source [props]="{ id: 'cities' }" />
    <y-map-layer [props]="{ source: 'cities', type: 'features', zIndex: 1700 }" />
    <y-map-feature-data-source [props]="{ id: 'markers' }" />

    <y-map-layer [props]="{ source: 'markers', type: 'features', zIndex: 3000 }" />


    <ng-container *ngFor="let m of cityMarkers; trackBy: trackByMarkerId">
      <y-map-default-marker [props]="{
      source: 'markers',
      coordinates: m.coordinates,
      title: m.title,
      color: m.color || '#E63D2E'
    }" />
    </ng-container>

    <!-- <y-map-feature-data-source [props]="{ id: 'markers' }" />
    <y-map-layer [props]="{ source: 'markers', type: 'features', zIndex: 1900 }" />


    <ng-container *ngIf="markerFeatures">
      <ng-container *ngFor="let f of markerFeatures; trackBy: trackByMarkerId">
        <y-map-feature [props]="f"></y-map-feature>
      </ng-container>
    </ng-container> -->

    <ng-container *ngFor="let m of cityMarkers">
      <y-map-marker [props]="{ coordinates: m.coordinates,hideOutsideViewport: true,zIndex: 3000 }">

        <div
          class="ym-marker"
          style="position: relative; z-index: 3000;"
          [appCollisionLabel]="m.id"
        >

          <!-- КРУГ -->
          <div
            class="ym-marker__circle"
            [style.--marker-color]="m.color || '#E63D2E'"
          >
            <svg viewBox="0 0 24 24">
              <!-- цветной круг -->
              <circle
                cx="12"
                cy="12"
                r="9"
                fill="var(--marker-color)"
              />
              <!-- белая обводка -->
              <circle
                cx="12"
                cy="12"
                r="9"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
              />
            </svg>
          </div>

          <!-- ИКОНКА (опционально) -->
          <div class="ym-marker__icon">
            <svg viewBox="0 0 24 24">
              <!-- пример landmark -->
              <!--
          <path
            fill="white"
            d="M12 3L2 9h20L12 3zm0 4l7 4H5l7-4zm-7 6h14v2H5v-2z"
          />
          -->
            </svg>
          </div>

          <!-- ТЕКСТ СПРАВА -->
          <div class="ym-marker__label">
            {{ m.title }}
          </div>

        </div>

      </y-map-marker>
    </ng-container>


    <!-- Рендерим фичи, привязанные к источнику 'cities' -->
    <ng-container *ngFor="let f of citiesFeatures; trackBy: trackById">
      <y-map-feature [props]="{
      source: 'cities',
      id: f.id,  
      geometry: f.geometry,
      properties: f.properties,
      style: f.style
    }" />

    </ng-container>




    <!-- <ng-container *ngFor="let m of cityMarkers">
      <y-map-default-marker [props]="{
      coordinates: m.coordinates,
      title: m.title,
      color: '#E63D2E'
    }" />
    </ng-container> -->


  </y-map>

</div>